<div class="config-section">
  <h2>AI Provider Configuration</h2>
  <p class="section-description">Choose your preferred AI provider and configure credentials</p>

  <!-- Provider Cards -->
  <div class="provider-cards">
    <!-- Google Gemini Card -->
    <div
      class="provider-card"
      [class.selected]="config().provider === 'gemini'"
      [class.expanded]="expandedProvider() === 'gemini'"
    >
      <div class="card-header" (click)="toggleProvider('gemini')">
        <div class="card-title">
          <span class="provider-icon">
            <img src="assets/icons/gemini-logo.svg" alt="Google Gemini" width="24" height="24" />
          </span>
          <div>
            <h3>Google Gemini <span class="recommended-badge">Recommended</span></h3>
            <p class="provider-desc">Google's multimodal AI model  - No credit card required</p>
          </div>
        </div>
        <div class="card-actions">
          @if (config().provider === 'gemini') {
          <span class="active-badge">Active</span>
          }
          <button
            type="button"
            class="expand-btn"
            [class.expanded]="expandedProvider() === 'gemini'"
          >
            {{ expandedProvider() === 'gemini' ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      @if (expandedProvider() === 'gemini') {
      <div class="card-content">
        <div class="form-group">
          <label for="gemini-key">API Key</label>
          <div class="input-with-toggle">
            <input
              id="gemini-key"
              [type]="showApiKeys().gemini ? 'text' : 'password'"
              [ngModel]="config().gemini.apiKey"
              (ngModelChange)="updateGeminiApiKey($event)"
              placeholder="Enter your Gemini API key"
            />
            <button
              type="button"
              class="toggle-visibility"
              (click)="toggleApiKeyVisibility('gemini')"
              aria-label="Toggle API key visibility"
            >
              {{ showApiKeys().gemini ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <small
            >Get your API key from
            <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener"
              >Google AI Studio</a
            ></small
          >
        </div>

        <div class="form-group">
          <div class="label-with-toggle">
            <label for="gemini-model">Model</label>
            <button
              type="button"
              class="toggle-input-mode"
              (click)="toggleCustomModelInput('gemini')"
            >
              {{ useCustomModel().gemini ? 'ğŸ“‹ Use Preset' : 'âœï¸ Custom Model' }}
            </button>
          </div>

          @if (useCustomModel().gemini) {
          <input
            id="gemini-model-custom"
            type="text"
            [ngModel]="config().gemini.modelName"
            (ngModelChange)="updateGeminiModel($event)"
            placeholder="e.g., gemini-2.0-flash-exp"
          />
          <small class="model-info">ğŸ’¡ Enter any Gemini model name</small>
          } @else {
          <select
            id="gemini-model"
            [ngModel]="config().gemini.modelName"
            (ngModelChange)="updateGeminiModel($event)"
          >
            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
            <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
            <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash Experimental</option>
          </select>
          }
        </div>

        <button class="btn btn-select" (click)="selectProvider('gemini')">Use Google Gemini</button>
      </div>
      }
    </div>

    <!-- OpenRouter Card (Recommended - Free) -->
    <div
      class="provider-card"
      [class.selected]="config().provider === 'openrouter'"
      [class.expanded]="expandedProvider() === 'openrouter'"
    >
      <div class="card-header" (click)="toggleProvider('openrouter')">
        <div class="card-title">
          <span class="provider-icon">
            <img src="assets/icons/openrouter-logo.svg" alt="OpenRouter" width="24" height="24" />
          </span>
          <div>
            <h3>OpenRouter <span class="recommended-badge">Recommended</span></h3>
            <p class="provider-desc">Multiple free AI models - No credit card required</p>
          </div>
        </div>
        <div class="card-actions">
          @if (config().provider === 'openrouter') {
          <span class="active-badge">Active</span>
          }
          <button
            type="button"
            class="expand-btn"
            [class.expanded]="expandedProvider() === 'openrouter'"
          >
            {{ expandedProvider() === 'openrouter' ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      @if (expandedProvider() === 'openrouter') {
      <div class="card-content">
        <div class="form-group">
          <label for="openrouter-key">API Key</label>
          <div class="input-with-toggle">
            <input
              id="openrouter-key"
              [type]="showApiKeys().openrouter ? 'text' : 'password'"
              [ngModel]="config().openrouter?.apiKey"
              (ngModelChange)="updateOpenRouterApiKey($event)"
              placeholder="sk-or-v1-..."
            />
            <button
              type="button"
              class="toggle-visibility"
              (click)="toggleApiKeyVisibility('openrouter')"
              aria-label="Toggle API key visibility"
            >
              {{ showApiKeys().openrouter ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <small
            >Get your free API key from
            <a href="https://openrouter.ai/keys" target="_blank" rel="noopener">OpenRouter</a>
          </small
          >
        </div>

        <div class="form-group">
          <div class="label-with-toggle">
            <label for="openrouter-model">Model (Free Tier Available)</label>
            <button
              type="button"
              class="toggle-input-mode"
              (click)="toggleCustomModelInput('openrouter')"
            >
              {{ useCustomModel().openrouter ? 'ğŸ“‹ Use Preset' : 'âœï¸ Custom Model' }}
            </button>
          </div>

          @if (useCustomModel().openrouter) {
          <input
            id="openrouter-model-custom"
            type="text"
            [ngModel]="config().openrouter?.modelName"
            (ngModelChange)="updateOpenRouterModel($event)"
            placeholder="e.g., meta-llama/llama-3.2-3b-instruct:free"
          />
          <small class="model-info"
            >ğŸ’¡ Enter any model ID from
            <a href="https://openrouter.ai/models" target="_blank">OpenRouter Models</a></small
          >
          } @else {
          <select
            id="openrouter-model"
            [ngModel]="config().openrouter?.modelName"
            (ngModelChange)="updateOpenRouterModel($event)"
          >
            <optgroup label="Popular Free Models">
              <option value="mistralai/mistral-7b-instruct:free">
                Mistral 7B Instruct (Best) â­
              </option>
              <option value="nvidia/nemotron-3-nano-30b-a3b:free">NVIDIA: Nemotron 3 Nano 30B A3B</option>
              <option value="google/gemma-3-27b-it:free">
                Google: Gemma 3 27B (free)
              </option>
              <!-- <option value="meta-llama/llama-3.2-3b-instruct:free">Llama 3.2 3B Instruct (Fast)</option>
                <option value="nousresearch/hermes-3-llama-3.1-405b:free">Hermes 3 Llama 405B (Powerful)</option> -->
            </optgroup>
            <optgroup label="Paid Models (Better Quality)">
              <option value="openai/gpt-4o-mini">GPT-4o Mini (Cheap)</option>
              <!-- <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet (Best)</option> -->
              <!-- <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option> -->
            </optgroup>
          </select>
          <small class="model-info"
            >ğŸ’¡ Free models have generous limits. Check
            <a href="https://openrouter.ai/models" target="_blank">OpenRouter Models</a> for current
            availability</small
          >
          }
        </div>

        <div class="form-group optional-group">
          <label for="openrouter-site-url">Site URL (Optional)</label>
          <input
            id="openrouter-site-url"
            type="text"
            [ngModel]="config().openrouter?.siteUrl"
            (ngModelChange)="updateOpenRouterSiteUrl($event)"
            placeholder="https://your-app.com"
          />
          <small>For usage tracking in OpenRouter dashboard</small>
        </div>

        <div class="form-group optional-group">
          <label for="openrouter-site-name">Site Name (Optional)</label>
          <input
            id="openrouter-site-name"
            type="text"
            [ngModel]="config().openrouter?.siteName"
            (ngModelChange)="updateOpenRouterSiteName($event)"
            placeholder="My English Learning App"
          />
          <small>Displayed in OpenRouter dashboard</small>
        </div>

        <button class="btn btn-select btn-recommended" (click)="selectProvider('openrouter')">
          âœ¨ Use OpenRouter (Free)
        </button>
      </div>
      }
    </div>

    <!-- OpenAI Card -->
    <div
      class="provider-card"
      [class.selected]="config().provider === 'openai'"
      [class.expanded]="expandedProvider() === 'openai'"
    >
      <div class="card-header" (click)="toggleProvider('openai')">
        <div class="card-title">
          <span class="provider-icon">
            <img src="assets/icons/openai-logo.svg" alt="OpenAI" width="24" height="24" />
          </span>
          <div>
            <h3>OpenAI</h3>
            <p class="provider-desc">Direct access to GPT models</p>
          </div>
        </div>
        <div class="card-actions">
          @if (config().provider === 'openai') {
          <span class="active-badge">Active</span>
          }
          <button
            type="button"
            class="expand-btn"
            [class.expanded]="expandedProvider() === 'openai'"
          >
            {{ expandedProvider() === 'openai' ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      @if (expandedProvider() === 'openai') {
      <div class="card-content">
        <div class="form-group">
          <label for="openai-key">API Key</label>
          <div class="input-with-toggle">
            <input
              id="openai-key"
              [type]="showApiKeys().openai ? 'text' : 'password'"
              [ngModel]="config().openai.apiKey"
              (ngModelChange)="updateOpenAIApiKey($event)"
              placeholder="sk-..."
            />
            <button
              type="button"
              class="toggle-visibility"
              (click)="toggleApiKeyVisibility('openai')"
              aria-label="Toggle API key visibility"
            >
              {{ showApiKeys().openai ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
          <small
            >Get your API key from
            <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener"
              >OpenAI Platform</a
            ></small
          >
        </div>

        <div class="form-group">
          <div class="label-with-toggle">
            <label for="openai-model">Model</label>
            <button
              type="button"
              class="toggle-input-mode"
              (click)="toggleCustomModelInput('openai')"
            >
              {{ useCustomModel().openai ? 'ğŸ“‹ Use Preset' : 'âœï¸ Custom Model' }}
            </button>
          </div>

          @if (useCustomModel().openai) {
          <input
            id="openai-model-custom"
            type="text"
            [ngModel]="config().openai.modelName"
            (ngModelChange)="updateOpenAIModel($event)"
            placeholder="e.g., gpt-4o-mini"
          />
          <small class="model-info">ğŸ’¡ Enter any OpenAI model name</small>
          } @else {
          <select
            id="openai-model"
            [ngModel]="config().openai.modelName"
            (ngModelChange)="updateOpenAIModel($event)"
          >
            <option value="gpt-5">GPT-5</option>
            <option value="gpt-5-mini">GPT-5 Mini</option>
            <option value="gpt-4o-mini">GPT-4o Mini</option>
          </select>
          }
        </div>

        <button class="btn btn-select" (click)="selectProvider('openai')">Use OpenAI</button>
      </div>
      }
    </div>

    <!-- Azure OpenAI Card - Only visible for specific user -->
    @if (showAzureProvider()) {
    <div
      class="provider-card"
      [class.selected]="config().provider === 'azure'"
      [class.expanded]="expandedProvider() === 'azure'"
    >
      <div class="card-header" (click)="toggleProvider('azure')">
        <div class="card-title">
          <span class="provider-icon">ğŸ”·</span>
          <div>
            <h3>Azure OpenAI</h3>
            <p class="provider-desc">Enterprise-grade AI with enhanced security</p>
          </div>
        </div>
        <div class="card-actions">
          @if (config().provider === 'azure') {
          <span class="active-badge">Active</span>
          }
          <button
            type="button"
            class="expand-btn"
            [class.expanded]="expandedProvider() === 'azure'"
          >
            {{ expandedProvider() === 'azure' ? 'â–¼' : 'â–¶' }}
          </button>
        </div>
      </div>

      @if (expandedProvider() === 'azure') {
      <div class="card-content">
        <div class="form-group">
          <label for="azure-endpoint">Endpoint URL</label>
          <input
            id="azure-endpoint"
            type="text"
            [ngModel]="config().azure.endpoint"
            (ngModelChange)="updateAzureEndpoint($event)"
            placeholder="https://your-resource.openai.azure.com/"
          />
        </div>

        <div class="form-group">
          <label for="azure-key">API Key</label>
          <div class="input-with-toggle">
            <input
              id="azure-key"
              [type]="showApiKeys().azure ? 'text' : 'password'"
              [ngModel]="config().azure.apiKey"
              (ngModelChange)="updateAzureApiKey($event)"
              placeholder="Enter your Azure OpenAI API key"
            />
            <button
              type="button"
              class="toggle-visibility"
              (click)="toggleApiKeyVisibility('azure')"
              aria-label="Toggle API key visibility"
            >
              {{ showApiKeys().azure ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="azure-deployment">Deployment Name</label>
          <input
            id="azure-deployment"
            type="text"
            [ngModel]="config().azure.deploymentName"
            (ngModelChange)="updateAzureDeployment($event)"
            placeholder="gpt-4"
          />
        </div>

        <button class="btn btn-select" (click)="selectProvider('azure')">Use Azure OpenAI</button>
      </div>
      }
    </div>
    }
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="btn btn-primary" (click)="saveConfig()">ğŸ’¾ Save Configuration</button>
    <button class="btn btn-secondary" (click)="clearConfig()">ğŸ—‘ï¸ Clear All</button>
  </div>

  <!-- Info Box -->
  <div class="info-box">
    <h4>ğŸ”’ Privacy & Security</h4>
    <p>
      Your API keys are stored locally in your browser and never sent to any server except the AI
      provider you configure.
    </p>
  </div>
</div>
